

















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2023-01-30 16:08:23 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="./assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="./assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="./assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="./assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    





    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="./assets/favicons/ds/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="./assets/favicons/ds/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./assets/favicons/ds/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="./assets/favicons/ds/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="./assets/favicons/ds/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="./assets/favicons/ds/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="./assets/favicons/ds/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="./assets/favicons/ds/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="./assets/favicons/ds/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="./assets/favicons/ds/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="./assets/favicons/ds/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="./assets/favicons/ds/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="./assets/favicons/ds/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Digital Skills - Data Analysis and Visualisation in Python for Researchers "/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="./assets/favicons/ds/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="./assets/favicons/ds/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="./assets/favicons/ds/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="./assets/favicons/ds/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="./assets/favicons/ds/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Data Analysis and Visualisation in Python for Researchers 
  </title>  

  </head>
  <body>

    



    <div class="container">
      

















  
  











<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      <a href="https://www.esciencecenter.nl/" class="pull-left">
        <img class="navbar-logo" src="./assets/img/netherlands-escience-center-logo-RGB.svg" alt="The Netherlands eScience Center logo" />
      </a>
      

      
      <a class="navbar-brand" href="./">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        

        

	
	

	
        
        <li><a href="https://esciencecenter-digital-skills.github.io/license">License</a></li>
        
    
        <li><a href="./post-workshop-exercise.html">Post-workshop exercise</a></li>
    
        <li><a href="./guided-post-workshop-exercise.html">Guided post-workshop exercise</a></li>
      </ul>
    </div>
  </div>
</nav>



















<h1 class="maintitle">Data Analysis and Visualisation in Python for Researchers </h1>



<article>
<h1 id="guided-version-post-workshop-exercise">Guided version post-workshop exercise</h1>
<p><strong>This is a guided version of the post-workshop exercise, please read the <a href="./post-workshop-exercise.html">the open version</a> first!</strong></p>

<h2 id="0-loading-cleaning-and-selecting-the-data">0. Loading, cleaning, and selecting the data</h2>
<p>Before you can solve any of the questions, you first need to load and clean the dataset. 
And select the right data. What follows are 
questions that help you with this, step by step, without providing the answers.</p>

<h3 id="01-loading-the-data">0.1 Loading the data</h3>
<ol>
  <li>Load the data into Python with pandas. (Hint: check the separator that is used in the file, you can pass a different separator to <code class="language-plaintext highlighter-rouge">read_csv()</code> using the <code class="language-plaintext highlighter-rouge">sep</code> argument)</li>
  <li>Take a look at the data. As you can see, the Topic is read as a column and not as index. You can fix this by passing <code class="language-plaintext highlighter-rouge">index_col='Topic'</code> to <code class="language-plaintext highlighter-rouge">read_csv()</code>.</li>
</ol>

<h3 id="02-cleaning-up-the-data">0.2 Cleaning up the data</h3>
<ol>
  <li>Take a look at the data. How are missing data represented?</li>
  <li>Replace the value that is used for missing data with NaN. (hint: You can replace values using DataFrame.replace(). You can use <code class="language-plaintext highlighter-rouge">numpy.nan</code> to represent NaN values. NumPy is the fundamental package for scientific computing with Python, it operates a lot on the background of Pandas, but in this case we will import it. This is usually done like this: <code class="language-plaintext highlighter-rouge">import numpy as np</code>)</li>
  <li>Rename the ‘Unnamed: 1’ column to ‘unit’</li>
  <li>What is the datatype of the numerical values?</li>
  <li>Convert all data in the numerical columns (all columns excluding ‘unit’) to the ‘float’ datatype. Use a for-loop to loop over all the numerical columns. Change the datatype of a specific column inside the body of the for-loop.</li>
  <li>If you want to be sure you have correctly cleaned the dataset you can download a cleaned csv file and use that for the next part.
Download the cleaned .csv file <a href="https://raw.githubusercontent.com/esciencecenter-digital-skills/2023-01-25-ds-python-rivm/main/data/Health__lifestyle__health_care_use_and_supply__causes_of_death__from_1900_21122022_143458_cleaned.csv">here</a>.
You can right-click and press ‘save as’ to download it.</li>
</ol>

<h3 id="03-dealing-with-topics-and-selecting-the-data-of-interest">0.3. Dealing with topics and selecting the data of interest</h3>
<p>The dataset is quite large, or at least there are a lot of different topics in there. 
(NB: the topics are the index, an example is ‘Use of health care services|Contacts with health professionals|Dentist’): 
The topics are organized in a nested way, separated with ‘|’. 
For example: ‘Use of health care services|Contacts with health professionals|Dentist’ consists of 3 levels: 
‘Use of health care services’ (level 1), ‘Contacts with health professionals’ (level 2), and  ‘Dentist’ (level 3). 
We will write some functions to create a better overview of the dataset and get quicker access to the different topics of our interest.</p>
<ol>
  <li>First figure out how to get the level 1 topic from a full topic description. Create a new string variable called topic: <code class="language-plaintext highlighter-rouge">topic = 'level 1| level 2 | level 3'</code>. Use the <a href="https://www.w3schools.com/python/ref_string_split.asp"><code class="language-plaintext highlighter-rouge">str.split</code></a> function and list indexing to get just the level 1 part of the string.</li>
  <li>Create a function that returns a list with just the seven unique level 1 topics in the dataset. Hint 1: use your answer from the previous question. Hint 2: You can loop over the topics in the dataframe by doing <code class="language-plaintext highlighter-rouge">for topic in df.index:</code>.</li>
  <li>Look at the code below. What does it do? Try it out! For example with <code class="language-plaintext highlighter-rouge">subset_data_starting_with(df, 'Use of health care services')</code>. Copy these functions to your notebook, it will be very handy for the next questions!</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">subset_data_starting_with</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
    <span class="n">topics</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">topics</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">mask</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">subset</span>

<span class="k">def</span> <span class="nf">rename_to_last_level</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">mapper</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">mapper</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></div>

<h2 id="1-plotting-contacts-with-health-professionals">1. Plotting contacts with health professionals</h2>
<p>We will look at the ‘Use of health care services|Contacts with health professionals’ data.
We want to get a visual overview of how many people have contact with health professionals. 
But first, it’s good to note that this is an aggregated dataset. 
Each value in the table actually comes from aggregating data of a lot of individuals. 
This is different from the dataset used in the course where every row corresponded with a single captured animal, and we had to aggregate it to plot.</p>

<p>To help ourselves in plotting the data we will convert the data to the so-called ‘long format’ (you can read more about this <a href="https://datacarpentry.org/python-socialsci/12-long-and-wide/index.html">here</a>). If you don’t fully grasp it yet that’s not a problem, just see it as a transformation of the data into a format that is handy for plotting. Here is the code for transforming our dataset to long format:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">to_long_format</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="s">"""
    Transforms the CBS health, lifestyle and causes of death dataset into 
    'long' format. In addition, drops the 'unit' column, and changes 'year'
    dtype to int.
    """</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s">'unit'</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'Topic'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span> <span class="c1"># pd.melt cannot use the index so we have to create a column for it
</span>    <span class="n">long_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s">'Topic'</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s">'year'</span><span class="p">)</span> 
    <span class="n">long_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span> <span class="o">=</span> <span class="n">long_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">long_df</span>
</code></pre></div></div>
<ol>
  <li>Inspect the <code class="language-plaintext highlighter-rouge">to_long_format()</code> function. Compare the dataframes before and after passing it to the function. Can you make sense of what’s happening and why?</li>
  <li>Now try to answer 1a. Hint: Use the functions we defined previously to select the data, and transform it to long format.</li>
  <li>Now try to answer 1b. Hint: plotnine by default wants to plot the count of the values you pass it.
Since our data is already aggregated we want to plot the actual values. You can do that by passing <code class="language-plaintext highlighter-rouge">stat='identity'</code> to the <code class="language-plaintext highlighter-rouge">geom_bar</code> function.</li>
</ol>

<h2 id="2-health-costs">2. Health costs</h2>
<p>One would expect that the percentage of people in good health would increase when the costs of our health system go up, is that true?</p>
<ol>
  <li>Take a look at the values for ‘Care supply|Expenditures on care|Costs as a percentage of the GDP’ and ‘Health status|Persons in (very) good health’. What do you notice? 
Hint: You can still use <code class="language-plaintext highlighter-rouge">subset_data_starting_with()</code> and use <code class="language-plaintext highlighter-rouge">pandas.concat()</code> to concatenate dataframes.</li>
  <li>Now try to answer 2a</li>
  <li>Now try to answer 2b. Hint 1: to calculate the indexed costs in 2000:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">costs_1990</span> <span class="o">=</span> <span class="mf">10.9</span>
<span class="n">costs_2000</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">indexed_costs_2000</span> <span class="o">=</span> <span class="n">costs_2000</span> <span class="o">/</span> <span class="mf">10.9</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div>    </div>
    <p>Hint 2: It is best to do the indexing operation before transforming the data to long format.</p>
  </li>
</ol>

</article>

      
      


<footer>
  <hr/>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016–2023
	
        <a href="https://carpentries.org/">The Carpentries</a>
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
        
        <a href="mailto:training@esciencecenter.nl">Contact The Training Team</a>
        
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    


<script src="./assets/js/jquery.min.js"></script>
<script src="./assets/js/bootstrap.min.js"></script>
<script src="./assets/js/lesson.js"></script>

<script>
/* Based on https://stackoverflow.com/a/30894829/1802726 */
var show_instructions = function() {
     //set all nav tabs to inactive
    $('.nav-tabs li').removeClass('active');

    //get all nav tabs matching the os and set to active
    $('.nav-tabs li a[href*="'+localStorage.os+'"]').closest('li').addClass('active');

    //set all tabs to inactive
    $('.tab-pane').removeClass('active');

    //get all tabs matching the os and set to active
    $('.tab-pane[id*="'+localStorage.os+'"]').addClass('active');
}

if (typeof(Storage) !== "undefined") {
    if (localStorage.os == "undefined") {
        localStorage.os = "windows";
    }
    show_instructions();
} else {
    console.log("No localStorage");
}

/* Based on https://stackoverflow.com/a/30894829/1802726 */
$('.nav-tabs li a').click(function(){
    //get selected os
    localStorage.os = $(this)[0].dataset.os;
    show_instructions();
});

  // detect misssing iframe for Eventbrite
  $(document).ready(function(){
      if ($('iframe').height() == 0) {
          $('iframe').before('<p>Looks like your adblocker blocked the registration window. Please navigate to <a href="https://www.eventbrite.com/tickets-external?eid=&ref=etckt">https://www.eventbrite.com/tickets-external?eid=&ref=etckt</a> to register.</p>');
      }
  });

  // hide alerts when site is rendered on carpentries.github.io
  $(document).ready(function() {
      if (location.href.startsWith("https://carpentries.github.io/workshop-template/")) {
          $("div.alert").hide();
      }
  });

</script>

  </body>
</html>
